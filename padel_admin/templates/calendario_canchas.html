{% extends 'base.html' %}
{% block content %}
<style>
.calendario-table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 2rem;
    font-size: 1rem;
}
.calendario-table th, .calendario-table td {
    border: 1px solid #ddd;
    text-align: center;
    padding: 0.5em 0.3em;
}
.calendario-table th {
    background: #2d3e50;
    color: #fff;
    font-weight: 600;
}
.calendario-table td.disponible {
    background: #e6ffe6;
}
.calendario-table td.ocupado {
    background: #ffe6e6;
    color: #b00;
    font-weight: 600;
}
.calendario-table td button {
    background: #2ecc40;
    color: #fff;
    border: none;
    border-radius: 4px;
    padding: 0.3em 0.8em;
    cursor: pointer;
    font-size: 0.95em;
    transition: background 0.2s;
}
.calendario-table td button:hover {
    background: #27ae60;
}
@media (max-width: 900px) {
    .calendario-table {
        font-size: 0.85rem;
    }
}
</style>

<h2 style="text-align:center; margin-bottom:1em;">Calendario semanal de canchas</h2>
<p style="text-align:center; color: #555; margin-bottom:1em;">
    Semana del <strong>{{ fechas_semana.0|date:'d/m/Y' }}</strong> al <strong>{{ fechas_semana|last|date:'d/m/Y' }}</strong>
</p>

{% if not calendario_cancha_filas or calendario_cancha_filas|length == 0 %}
    <div class="ui warning message">No hay canchas registradas en el sistema.</div>
{% else %}
    <div style="overflow-x:auto;">
    {% for cancha, filas in calendario_cancha_filas %}
        <h3>Cancha {{ cancha.numero }} ({{ cancha.tipo }})</h3>
        <table class="calendario-table">
            <thead>
                <tr>
                    <th>Hora</th>
                    {% for fecha in fechas_semana %}
                        <th>{{ fecha|date:'D d/m' }}</th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for fila in filas %}
                <tr>
                    <td>{{ fila.hora|time:'H:i' }}</td>
                    {% for estado, fecha in fila.estados %}
                        {% if estado %}
                            <td class="ocupado">Ocupado</td>
                        {% else %}
                            <td class="disponible">
                                <form method="post" action="{% url 'reservar_cancha' %}">
                                    {% csrf_token %}
                                    <input type="hidden" name="cancha_id" value="{{ cancha.numero }}">
                                    <input type="hidden" name="fecha" value="{{ fecha }}">
                                    <input type="hidden" name="hora_inicio" value="{{ fila.hora|time:'H:i:s' }}">
                                    <button type="submit">Reservar</button>
                                </form>
                            </td>
                        {% endif %}
                    {% endfor %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% endfor %}
    </div>
{% endif %}

{% endblock %}
